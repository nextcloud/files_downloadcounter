/*! third party licenses: js/vendor.LICENSE.txt */
import{g as A,b as $,l as k}from"./logger-DZIvzaVr.mjs";var S=/["'&<>]/,q=C;function C(n){var t=""+n,i=S.exec(t);if(!i)return t;var e,r="",o=0,a=0;for(o=i.index;o<t.length;o++){switch(t.charCodeAt(o)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}a!==o&&(r+=t.substring(a,o)),a=o+1,r+=e}return a!==o?r+t.substring(a,o):r}const D=A(q);function z(n,t,i){const e=document.querySelector("#initial-state-".concat(n,"-").concat(t));if(e===null){if(i!==void 0)return i;throw new Error("Could not find initial state ".concat(t," of ").concat(n))}try{return JSON.parse(atob(e.value))}catch{throw new Error("Could not parse initial state ".concat(t," of ").concat(n))}}function h(n){var t,i,e,r;return{translations:(i=(t=window._oc_l10n_registry_translations)===null||t===void 0?void 0:t[n])!==null&&i!==void 0?i:{},pluralFunction:(r=(e=window._oc_l10n_registry_plural_functions)===null||e===void 0?void 0:e[n])!==null&&r!==void 0?r:o=>o}}function d(n,t,i,e,r){const o=Object.assign({},{escape:!0,sanitize:!0},r||{}),a=m=>m,s=o.sanitize?$.sanitize:a,c=o.escape?D:a,u=(m,w,E)=>m.replace(/%n/g,""+E).replace(/{([^{}]*)}/g,(g,_)=>{if(w===void 0||!(_ in w))return s(g);const p=w[_];return s(typeof p=="string"||typeof p=="number"?c(p):g)});let l=h(n).translations[t]||t;return l=Array.isArray(l)?l[0]:l,s(typeof i=="object"||e!==void 0?u(l,i,e):l)}function O(n,t,i,e,r,o){const a="_"+t+"_::_"+i+"_",s=h(n),c=s.translations[a];if(typeof c<"u"){const u=c;if(Array.isArray(u)){const l=s.pluralFunction(e);return d(n,u[l],r,e,o)}}return e===1?d(n,t,r,e,o):d(n,i,r,e,o)}const{limit:v,downloads:x}=z("files_downloadlimit","download_limit",{limit:-1,downloads:0});k.debug("Download limit",{limit:v,downloads:x});let f=v-x,y=0;const b=(n,t)=>{t===0?n.innerText=d("files_downloadlimit","You have reached the maximum amount of downloads allowed"):n.innerText=O("files_downloadlimit","1 remaining download allowed","{count} remaining downloads allowed",t,{count:t})};window.addEventListener("DOMContentLoaded",()=>{if(v<1)return;const n=document.getElementById("header-primary-action");if(!n)return;const t=document.createElement("span");t.setAttribute("style","color: var(--color-primary-text); padding: 0 10px;"),b(t,f),n.prepend(t);const i=document.querySelector("#files-public-content");if(!i)return;i.oncontextmenu=r=>(r.preventDefault(),r.stopPropagation(),!1);const e=document.querySelectorAll('a[href*="/download/"]')||[];new Set(e).forEach(r=>{r.addEventListener("click",o=>{if(y>0&&!confirm(d("files_downloadlimit","This share has a limited number of downloads. Are you sure you want to trigger a new download?"))){o.preventDefault(),o.stopPropagation();return}f--,y++,b(t,f),f===0&&[...e].forEach(a=>a.remove())})})});
